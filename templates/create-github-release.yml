## NOTE: requires the persistCredentials: true parameter in the checkout step (https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=azure-devops&tabs=schema%2Cparameter-schema#checkout)

# create parameters
parameters:
  githubApiUrl: 'https://api.github.com'  # Github API base url

steps:  
# install jq
- bash: sudo apt-get update && sudo apt-get install jq && sudo apt-get install curl
  displayName: 'Install bash dependencies'

# github release
- bash: |
    jq -n --arg eventType "release" --arg version "$(Build.BuildNumber)" '{event_type:$eventType,client_payload:{version:$version}}'
    jq -n \
      --arg eventType "release" \
      --arg version "$(Build.BuildNumber)" \
      '{
          event_type:$eventType,
          client_payload:{
              version:$version
          }
      }' \
      | curl -d @- \
          -X POST \
          -H "Accept: application/vnd.github.v3+json" \
          --silent \
          ${{ parameters.githubApiUrl }}/repos/$(Build.Repository.Name)/dispatches
  displayName: 'Github Release'